<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Model 1</title>
    <link rel="stylesheet" href="/src/css/study.css">

</head>
<body>
<h1>Model 1과 JDBC</h1>
<section>
    <h2>Model 1이란?</h2>
    <ul>
        <li>JSP 중심 구조. JSP가 화면 렌더링과 단순 로직까지 맡는다.</li>
        <li>서블릿은 라우팅이나 간단한 전처리(파라미터 파싱, 조회 호출) 정도만 보조한다.</li>
        <li>장점: 빠르게 화면까지 구현 가능. 단점: 화면/로직 혼재로 규모가 커지면 유지보수 어려움.</li>
    </ul>
</section>

<section>
    <h2>EMP CRUD Model Web App</h2>
    <ul>
        <li>기본적인 웹 애플리케이션이 제공하는 핵심 기능인 CRUD(Create, Read, Update, Delete)를 직접 구현해본다.</li>
        <li>사원(EMP) 데이터를 중심으로 등록, 조회, 수정, 삭제가 가능한 웹 서비스를 완성한다.</li>
        <li>Model 1 구조(JSP 없이 Servlet 중심)로 구현하며, 실제 서비스 흐름을 단일 구조에서 경험한다.</li>
        <li>구현 과정에서 중복되는 코드와 로직을 직접 마주함으로써, 구조적 한계를 인식하고 개선 필요성을 체감한다.</li>
        <li>화면 구성, 요청 처리, 데이터 관리까지 모든 과정을 한 사람이 담당하는 구조에서 “역할 분담의 어려움”을 이해한다.</li>
        <li>CRUD 각각의 처리 흐름(Read와 Create, Update, Delete의 차이)을 명확히 구분하고, 요청/응답 구조를 분석한다.</li>
        <li>최종적으로 Model 1 방식의 문제점을 파악하고, 이후 Model 2(MVC)로의 전환 이유를 자연스럽게 학습한다.</li>
    </ul>
</section>


<section>
    <h2>URL 설계</h2>
    <ul>
        <li>홈 : <code>GET /index.jsp → EmpListServlet</code> </li>
        <li>목록: <code>GET /emp/list.do</code> </li>
        <li>상세: <code>GET /emp/detail.do?empno=9977 → EmpDetailServlet</code> </li>
        <li>등록 폼: <code>GET /emp/create.do → EmpCreateServlet</code> </li>
        <li>등록 처리: <code>POST /emp/create.do → EmpCreateServlet</code> (처리 후 redirect)</li>
        <li>수정 폼: <code>GET /emp/update.do?empno=9977  → EmpCreateServlet</code> </li>
        <li>수정 처리: <code>POST /emp/update.do → EmpCreateServlet</code> (처리 후 redirect)</li>
        <li>삭제 처리: <code>GET /emp/delete.do?empno=9977 → EmpRemoveServlet</code> (처리 후 redirect)</li>
    </ul>
</section>

<section>
    <h2>Read: List(설명)</h2>
    <ul>
        <li>요청: <code>GET /emp/list.do</code></li>
        <li>처리: DB에서 <code>empno</code> 정렬 조회</li>
        <li>렌더링: 서블릿이 <code>table</code> 형태 HTML 직접 생성
            <ul>
                <li>각 항목에 상세 링크: <code>/emp/detail.do?empno=...</code></li>
                <li>상단에 등록 링크: <code>/emp/form.do</code></li>
            </ul>
        </li>
        <li>오류 시: <code>sendError</code> 또는 목록 화면 상단에 간단 문구 삽입</li>
    </ul>
    <hr>
    <h3>예시코드</h3>
    <code><xmp>@WebServlet("/emp/list.do")
public class EmpListServlet extends HttpServlet {
  @Override
  protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws IOException {
    resp.setContentType("text/html; charset=UTF-8");
    Class.forName("oracle.jdbc.OracleDriver");

    try (Connection conn = DriverManager.getConnection(
            "jdbc:oracle:thin:@//localhost:1521/XEPDB1", "scott", "tiger");
         PreparedStatement ps = conn.prepareStatement(
            "SELECT empno, ename, job FROM emp ORDER BY empno");
         ResultSet rs = ps.executeQuery();
         PrintWriter out = resp.getWriter()) {

      out.println("<!DOCTYPE html><html lang='ko'><head><meta charset='UTF-8'><title>EMP 목록</title></head><body>");
      out.println("<h1>사원 목록</h1>");
      out.println("<p><a href='"+req.getContextPath()+"/emp/create.do'>사원 등록</a></p>");
      out.println("<table border='1' cellpadding='6' cellspacing='0'>");
      out.println("<tr><th>empno</th><th>ename</th><th>job</th><th>상세</th></tr>");

      while (rs.next()) {
        int empno = rs.getInt("empno");
        out.println("<tr>");
        out.println("<td>"+empno+"</td>");
        out.println("<td>"+rs.getString("ename")+"</td>");
        out.println("<td>"+rs.getString("job")+"</td>");
        out.println("<td><a href='"+req.getContextPath()+"/emp/detail.do?empno="+empno+"'>보기</a></td>");
        out.println("</tr>");
      }

      out.println("</table></body></html>");
    } catch (Exception e) {
      resp.sendError(500, "목록 조회 실패: " + e.getMessage());
    }
  }
}</xmp></code>
</section>


<section>
    <h2>Read: Detail(설명)</h2>
    <ul>
        <li>요청: <code>GET /emp/detail.do?empno=...</code></li>
        <li>파라미터 수집·검증(필수:  <code>empno</code>) 없으면 400</li>
        <li>렌더링: 서블릿이 항목 정보 리스트로 직접 출력
            <ul>
                <li>하단 액션: 수정 진입(<code>/emp/update.do?empno=...</code>)</li>
            </ul>
        </li>
        <li>데이터 없음: 안내 문구와 목록 링크만 출력</li>
    </ul>
    <h3>예시코드</h3>
    <code><pre>@WebServlet("/emp/detail.do")
public class EmpDetailServlet extends HttpServlet {
  @Override
    protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws IOException {
        resp.setContentType("text/html; charset=UTF-8");
        String empnoStr = req.getParameter("empno");
        if (empnoStr == null || empnoStr.isBlank()) {
          resp.sendError(400, "empno 파라미터가 필요합니다.");
          return;
        }

        Class.forName("oracle.jdbc.OracleDriver");

        try (Connection conn = DriverManager.getConnection(
            "jdbc:oracle:thin:@//localhost:1521/XEPDB1", "scott", "tiger");
            PreparedStatement ps = conn.prepareStatement(
            "SELECT empno, ename, job, deptno, sal, hiredate FROM emp WHERE empno=?");
            PrintWriter out = resp.getWriter()) {

            ps.setInt(1, Integer.parseInt(empnoStr));
            try (ResultSet rs = ps.executeQuery()) {
                out.println("<!DOCTYPE html><html lang='ko'><head><meta charset='UTF-8'><title>EMP 상세</title></head><body>");
                out.println("<h1>사원 상세</h1>");

                if (!rs.next()) {
                    out.println("<p>데이터 없음</p>");
                    out.println("<p><a href='"+req.getContextPath()+"/emp/list.do'>목록</a></p></body></html>");
                    return;
                }

                int empno = rs.getInt("empno");
                out.println("<ul>");
                out.println("<li>empno: "+empno+"</li>");
                out.println("<li>ename: "+rs.getString("ename")+"</li>");
                out.println("<li>job: "+rs.getString("job")+"</li>");
                out.println("<li>deptno: "+rs.getInt("deptno")+"</li>");
                out.println("<li>sal: "+rs.getDouble("sal")+"</li>");
                out.println("<li>hiredate: "+rs.getDate("hiredate")+"</li>");
                out.println("</ul>");
                out.println("<p><a href='"+req.getContextPath()+"/emp/list.do'>목록</a> | "
                + "<a href='"+req.getContextPath()+"/emp/update.do?empno="+empno+"'>수정</a></p>");
                out.println("</body></html>");
            }
        } catch (Exception e) {
        resp.sendError(500, "상세 조회 실패: " + e.getMessage());
        }
    }
}</pre></code>
</section>


<section>
    <h2>Create: Register(설명)</h2>
    <ul>
        <li>등록 폼 진입: <code>GET /emp/create.do</code> → 서블릿이 입력 폼 HTML 직접 출력</li>
        <li>등록 제출: <code>POST /emp/create.do</code>
            <ul>
                <li>파라미터 수집·검증(필수: empno, ename) 없으면 400</li>
                <li>DB INSERT 실행</li>
                <li>정상: <code>sendRedirect("/emp/list.do?ok=1")</code></li>
                <li>실패: <code>sendRedirect("/emp/create.do?error=...")</code> </li>
            </ul>
        </li>
        <li>이미 존재하는 empno PK 검증, 존재하는 deptno FK 검증,</li>
    </ul>
    <code><xmp>@WebServlet("/emp/create.do")
        public class EmpCreateServlet extends HttpServlet {
            @Override
            protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws IOException {
            resp.setContentType("text/html; charset=UTF-8");
            try (PrintWriter out = resp.getWriter()) {
            out.println("<!DOCTYPE html><html lang='ko'><head><meta charset='UTF-8'><title>사원 등록</title></head><body>");
            out.println("<h1>사원 등록</h1>");
            out.println("<form method='post' action='"+req.getContextPath()+"/emp/create.do'>");
                out.println("<p>empno <input type='number' name='empno' required></p>");
                out.println("<p>ename <input type='text' name='ename' required></p>");
                out.println("<p>job <input type='text' name='job'></p>");
                out.println("<p>deptno <input type='number' name='deptno'></p>");
                out.println("<p>sal <input type='number' step='0.01' name='sal'></p>");
                out.println("<p>hiredate <input type='date' name='hiredate'></p>");
                out.println("<p><button type='submit'>저장</button> <a href='"+req.getContextPath()+"/emp/list.do'>목록</a></p>");
                out.println("</form></body></html>");
            }
        }

        @Override
        protected void doPost(HttpServletRequest req, HttpServletResponse resp) throws IOException {
            req.setCharacterEncoding("UTF-8");
            String empno = req.getParameter("empno");
            String ename = req.getParameter("ename");
            if (empno == null || ename == null || empno.isBlank() || ename.isBlank()) {
                resp.sendError(400, "empno와 ename은 필수입니다.");
                return;
            }

            Class.forName("oracle.jdbc.OracleDriver");

            try (Connection conn = DriverManager.getConnection(
                "jdbc:oracle:thin:@//localhost:1521/XEPDB1", "scott", "tiger");
                PreparedStatement ps = conn.prepareStatement(
                "INSERT INTO emp(empno, ename, job, deptno, sal, hiredate) VALUES(?,?,?,?,?,?)")) {

                ps.setInt(1, Integer.parseInt(empno));
                ps.setString(2, ename);
                ps.setString(3, req.getParameter("job"));
                String dept = req.getParameter("deptno");
                if (dept == null || dept.isBlank()) ps.setNull(4, java.sql.Types.INTEGER);
                else ps.setInt(4, Integer.parseInt(dept));
                String sal = req.getParameter("sal");
                if (sal == null || sal.isBlank()) ps.setNull(5, java.sql.Types.DECIMAL);
                else ps.setBigDecimal(5, new java.math.BigDecimal(sal));
                String hd = req.getParameter("hiredate");
                if (hd == null || hd.isBlank()) ps.setNull(6, java.sql.Types.DATE);
                else ps.setDate(6, java.sql.Date.valueOf(hd));

                ps.executeUpdate();
                resp.sendRedirect(req.getContextPath()+"/emp/list.do?ok=1");

                } catch (Exception e) {
                    resp.sendRedirect(req.getContextPath()+"/emp/create.do?error=" +
                    java.net.URLEncoder.encode(e.getMessage(), "UTF-8"));
                }
            }
        }</xmp></code>
</section>
<section>
    <h2>Update: Modify(설명)</h2>
    <ul>
        <li>수정 폼 진입: <code>GET /emp/update.do?empno=...</code> → Read: Detail과 등일, 서블릿이 입력 폼 HTML 직접 출력</li>
        <li>수정 제출: <code>POST /emp/update.do</code>
            <ul>
                <li>파라미터 수집·검증(필수: empno, ename)  없으면 400</li>
                <li>DB UPDATE 실행</li>
                <li>정상: <code>sendRedirect("/emp/list.do?ok=1")</code></li>
                <li>실패: <code>sendRedirect("/emp/update.do?empno=...error=...")</code> </li>
            </ul>
        </li>
        <li>존재하는 empno PK 검증, 존재하는 deptno FK 검증</li>
    </ul>
    <code><xmp>@WebServlet("/emp/update.do")
public class EmpUpdateServlet extends HttpServlet {
  @Override
  protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws IOException {
    String empno = req.getParameter("empno");
    if (empno == null || empno.isBlank()) {
      resp.sendError(400, "empno 파라미터가 필요합니다.");
      return;
    }
    resp.setContentType("text/html; charset=UTF-8");
    Class.forName("oracle.jdbc.OracleDriver");

    try (Connection conn = DriverManager.getConnection(
            "jdbc:oracle:thin:@//localhost:1521/XEPDB1", "scott", "tiger");
         PreparedStatement ps = conn.prepareStatement(
            "SELECT empno, ename, job, deptno, sal, hiredate FROM emp WHERE empno=?");
         PrintWriter out = resp.getWriter()) {

      ps.setInt(1, Integer.parseInt(empno));
      try (ResultSet rs = ps.executeQuery()) {
        out.println("<!DOCTYPE html><html lang='ko'><head><meta charset='UTF-8'><title>사원 수정</title></head><body>");
        out.println("<h1>사원 수정</h1>");
        if (!rs.next()) {
          out.println("<p>데이터 없음</p></body></html>");
          return;
        }

        out.println("<form method='post' action='"+req.getContextPath()+"/emp/update.do'>");
        out.println("<input type='hidden' name='empno' value='"+rs.getInt("empno")+"'>");
        out.println("<p>ename <input type='text' name='ename' value='"+rs.getString("ename")+"' required></p>");
        out.println("<p>job <input type='text' name='job' value='"+rs.getString("job")+"'></p>");
        out.println("<p>deptno <input type='number' name='deptno' value='"+rs.getInt("deptno")+"'></p>");
        out.println("<p>sal <input type='number' step='0.01' name='sal' value='"+rs.getDouble("sal")+"'></p>");
        out.println("<p>hiredate <input type='date' name='hiredate' value='"+(rs.getDate("hiredate")==null?"":rs.getDate("hiredate"))+"'></p>");
        out.println("<p><button type='submit'>수정</button> <a href='"+req.getContextPath()+"/emp/list.do'>목록</a></p>");
        out.println("</form>");
        out.println("<hr><p><a href='"+req.getContextPath()+"/emp/delete.do?empno="+rs.getInt("empno")+"'>삭제</a></p>");
        out.println("</body></html>");
      }
    } catch (Exception e) {
      resp.sendError(500, "수정 폼 오류: " + e.getMessage());
    }
  }

  @Override
  protected void doPost(HttpServletRequest req, HttpServletResponse resp) throws IOException {
    req.setCharacterEncoding("UTF-8");
    String empno = req.getParameter("empno");
    String ename = req.getParameter("ename");
    if (empno == null || ename == null || empno.isBlank() || ename.isBlank()) {
      resp.sendError(400, "empno, ename 필수");
      return;
    }

    Class.forName("oracle.jdbc.OracleDriver");

    try (Connection conn = DriverManager.getConnection(
            "jdbc:oracle:thin:@//localhost:1521/XEPDB1", "scott", "tiger");
         PreparedStatement ps = conn.prepareStatement(
            "UPDATE emp SET ename=?, job=?, deptno=?, sal=?, hiredate=? WHERE empno=?")) {

      ps.setString(1, ename);
      ps.setString(2, req.getParameter("job"));
      String dept = req.getParameter("deptno");
      if (dept == null || dept.isBlank()) ps.setNull(3, java.sql.Types.INTEGER);
      else ps.setInt(3, Integer.parseInt(dept));
      String sal = req.getParameter("sal");
      if (sal == null || sal.isBlank()) ps.setNull(4, java.sql.Types.DECIMAL);
      else ps.setBigDecimal(4, new java.math.BigDecimal(sal));
      String hd = req.getParameter("hiredate");
      if (hd == null || hd.isBlank()) ps.setNull(5, java.sql.Types.DATE);
      else ps.setDate(5, java.sql.Date.valueOf(hd));
      ps.setInt(6, Integer.parseInt(empno));
      ps.executeUpdate();
      resp.sendRedirect(req.getContextPath()+"/emp/list.do?ok=1");

    } catch (Exception e) {
      resp.sendRedirect(req.getContextPath()+"/emp/update.do?empno="+empno+"&error=" +
          java.net.URLEncoder.encode(e.getMessage(), "UTF-8"));
    }
  }
}</xmp></code>
</section>
<section>
    <h2>Delete: Remove(설명)</h2>
    <ul>
        <li>수정 폼 진입: <code>GET /emp/update.do?empno=...</code> → 수정폼 하단에 삭제 링크 작성</li>
        <li>삭제 링크 : <code>GET /emp/delete.do?empno=...</code>
            <ul>
                <li>파라미터 수집·검증(필수: empno) 없으면 400</li>
                <li>DB DELETE 실행</li>
                <li>정상: <code>sendRedirect("/emp/list.do?ok=1")</code></li>
                <li>실패: <code>sendRedirect("/emp/update.do?empno=...error=...")</code> </li>
            </ul>
        </li>
    </ul>
    <pre><xmp>@WebServlet("/emp/delete.do")
public class EmpRemoveServlet extends HttpServlet {
  @Override
  protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws IOException {
    String empno = req.getParameter("empno");
    if (empno == null || empno.isBlank()) {
      resp.sendError(400, "empno 필요");
      return;
    }
    Class.forName("oracle.jdbc.OracleDriver");
    try (Connection conn = DriverManager.getConnection(
            "jdbc:oracle:thin:@//localhost:1521/XEPDB1", "scott", "tiger");
         PreparedStatement ps = conn.prepareStatement("DELETE FROM emp WHERE empno=?")) {
      ps.setInt(1, Integer.parseInt(empno));
      ps.executeUpdate();
      resp.sendRedirect(req.getContextPath()+"/emp/list.do?ok=1");
    } catch (Exception e) {
      resp.sendRedirect(req.getContextPath()+"/emp/update.do?empno="+empno+"&error=" +
          java.net.URLEncoder.encode(e.getMessage(), "UTF-8"));
    }
  }
}</xmp></pre>
</section>

</body>
</html>